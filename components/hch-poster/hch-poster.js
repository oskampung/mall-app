(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/hch-poster/hch-poster"],{5786:function(t,e,n){"use strict";n.r(e);var o=n("5be4"),s=n.n(o);for(var a in o)"default"!==a&&function(t){n.d(e,t,(function(){return o[t]}))}(a);e["default"]=s.a},"5be4":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={data:function(){return{}},props:{canvasFlag:{type:Boolean,default:!0},posterObj:{type:Object,default:{url:"",icon:"",title:"",discountPrice:"250.00",orignPrice:"300.00",code:""}}},methods:{roundRect:function(t,e,n,o,s,a,i,l,r){if(t.beginPath(),t.arc(e+a,n+a,a,Math.PI,1.5*Math.PI),t.moveTo(e+a,n),t.lineTo(e+o-a,n),t.arc(e+o-a,n+a,a,1.5*Math.PI,2*Math.PI),t.lineTo(e+o,n+s-a),t.arc(e+o-a,n+s-a,a,0,.5*Math.PI),t.arc(e+a,n+s-a,a,.5*Math.PI,Math.PI),t.lineTo(e,n+a),"btn"==r){var c=t.createLinearGradient(0,0,200,0);c.addColorStop(0,i),c.addColorStop(1,l),t.setFillStyle(c),t.fill()}else i&&(t.setFillStyle(i),t.fill()),l&&(t.setStrokeStyle(l),t.stroke());t.closePath(),t.clip()},canvasMultiLineText:function(t,e,n,o){for(var s=e.split(""),a="",i=[],l=0;l<s.length;l++)t.measureText(a).width<n?a+=s[l]:(l--,i.push(a),a="");if(i.push(a),i.length>o){for(var r=i.slice(0,o),c=r[1],h="",f=[],u=0;u<c.length;u++){if(!(t.measureText(h).width<n))break;h+=c[u]}f.push(h);var d=f[0]+"...";r.splice(o-1,1,d),i=r}return i},createCanvasImage:function(){console.log(this.posterObj),wx.showLoading({title:"海报生成中..."});var e=this,n=wx.getSystemInfoSync();this.phoneH=n.windowHeight,this.phoneW=n.windowWidth;this.phoneW;var o=this.phoneH/667;console.log(this.phoneH,this.phoneW);var s=wx.createCanvasContext("myCanvas"),a=this.posterObj.url,i=(this.posterObj.icon,this.posterObj.code),l="https://auu.oss-cn-hangzhou.aliyuncs.com/close.png";s.draw(),s.save(),this.roundRect(s,50,40,this.phoneW-100,this.phoneH-100,10,"#FFFFFF","#FFFFFF"),s.restore(),s.save(),this.roundRect(s,50,40,this.phoneW-100,360*o,10,"#f7f7f7","#f7f7f7"),s.restore(),wx.getImageInfo({src:a,success:function(t){s.save(),e.roundRect(s,(e.phoneW-(e.phoneW-110))/2,55,e.phoneW-110,240*o,10,"#f7f7f7","#f7f7f7"),s.drawImage(t.path,(e.phoneW-(e.phoneW-110))/2,55,e.phoneW-110,240*o,10),s.restore(),s.draw(!0)},fail:function(){e.canvasFlag=!0,t.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}}),wx.getImageInfo({src:l,success:function(t){s.drawImage(t.path,e.phoneW-100+50+5,40,24,24),s.draw(!0)},fail:function(){e.canvasFlag=!0,t.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}}),s.setGlobalAlpha(1),s.setFillStyle("#1c1c1c"),s.setFontSize(14),s.font="normal bold 14px sans-serif";for(var r=this.posterObj.title,c=this.canvasMultiLineText(s,r,this.phoneW-130,2),h=340,f=65,u=20,d=0;d<c.length;d++)s.fillText(c[d],f,(h+u*d-15)*o,this.phoneW-130),s.draw(!0);wx.getImageInfo({src:this.posterObj.avatarUrl,success:function(t){s.save(),e.roundRect(s,65,360*o,50,50,25,"#f7f7f7","#f7f7f7"),s.drawImage(t.path,65,360*o,50,50),s.restore(),s.draw(!0)},fail:function(){e.canvasFlag=!0,t.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}}),s.setGlobalAlpha(1),s.setFillStyle("#c2c291"),s.setFontSize(12),s.font="normal bold 14px sans-serif";for(var p=this.posterObj.nickName,v=this.canvasMultiLineText(s,p,80,3),g=430*o,w=65,F=15,b=0;b<v.length;b++)s.fillText(v[b],w,(g+F*b-15)*o,this.phoneW-130),s.draw(!0);var x="推荐价",m=s.measureText(x).width;s.fillText(x,120,400*o,m),s.setFontSize(14),s.setFillStyle("#c00000"),s.font="normal 12px sans-serif",s.fillText("￥",140+m,400*o,20),s.setFontSize(20);var T=this.posterObj.discountPrice,S=s.measureText(T).width;s.fillText(T,150+m,400*o,S),s.beginPath(),s.setFontSize(16),s.setFillStyle("#999999");var I=this.posterObj.orignPrice,W=s.measureText(I).width;s.fillText("￥".concat(I),150+m+S+5,400*o,W),s.moveTo(150+m+S+5,395*o),s.lineTo(150+m+S+5+W,395*o),s.setStrokeStyle("#999999"),s.stroke(),s.closePath(),wx.getImageInfo({src:i,success:function(t){s.drawImage(t.path,(e.phoneW-60)/2,430*o,70,70),s.draw(!0)},fail:function(){e.canvasFlag=!0,t.showToast({title:"小程序码生成失败",duration:2e3,icon:"none"})}}),s.setFontSize(14),s.setFillStyle("#2f1709"),s.font="normal bold 14px sans-serif",s.fillText(this.posterObj.shopName,(e.phoneW-60)/2,520*o,90),s.setFontSize(14),s.setFillStyle("#ff5f33"),s.font="normal 14px sans-serif",s.fillText("长按/扫描识别查看商品",(e.phoneW-140)/2,550*o,140),s.save(),this.roundRect(s,(this.phoneW-100)/2,this.phoneH-65,100,30,15,"#ff3600","#ff6a00","btn"),s.restore(),s.setFontSize(14),s.setFillStyle("#FFFFFF"),s.font="normal bold 14px sans-serif",s.fillText("保存图片",(e.phoneW-58)/2,this.phoneH-45,58),wx.hideLoading()},saveCanvasImage:function(){wx.showLoading({title:"保存中..."});var e=this;t.canvasToTempFilePath({x:50,y:45,width:this.phoneW-100,height:this.phoneH-120,destWidth:5*(this.phoneW-100),destHeight:5*(this.phoneH-120),canvasId:"myCanvas",success:function(n){t.saveImageToPhotosAlbum({filePath:n.tempFilePath,success:function(n){wx.hideLoading(),t.showToast({title:"图片保存成功，可以去分享啦~",duration:2e3}),e.canvasCancelEvn()},fail:function(){t.showToast({title:"保存失败，稍后再试",duration:2e3,icon:"none"}),wx.hideLoading()}})},fail:function(){t.showToast({title:"保存失败，稍后再试",duration:2e3,icon:"none"}),wx.hideLoading()}})},canvasCancelEvn:function(){this.$emit("cancel",!0)}}};e.default=n}).call(this,n("543d")["default"])},6670:function(t,e,n){"use strict";n.r(e);var o=n("edfc"),s=n("5786");for(var a in s)"default"!==a&&function(t){n.d(e,t,(function(){return s[t]}))}(a);n("8bce");var i,l=n("f0c5"),r=Object(l["a"])(s["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],i);e["default"]=r.exports},"72cb":function(t,e,n){},"8bce":function(t,e,n){"use strict";var o=n("72cb"),s=n.n(o);s.a},edfc:function(t,e,n){"use strict";var o,s=function(){var t=this,e=t.$createElement;t._self._c},a=[];n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return o}))}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/hch-poster/hch-poster-create-component',
    {
        'components/hch-poster/hch-poster-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("6670"))
        })
    },
    [['components/hch-poster/hch-poster-create-component']]
]);
