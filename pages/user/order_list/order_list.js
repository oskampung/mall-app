(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/order_list/order_list"],{"2f75":function(e,t,n){"use strict";(function(e){n("1822");r(n("66fd"));var t=r(n("c2a2"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},"3deb":function(e,t,n){"use strict";var r={"uni-collapse":function(){return n.e("components/uni-collapse/uni-collapse").then(n.bind(null,"8202"))},"uni-collapse-item":function(){return n.e("components/uni-collapse-item/uni-collapse-item").then(n.bind(null,"cf28"))},"uni-steps":function(){return n.e("components/uni-steps/uni-steps").then(n.bind(null,"92e3"))}},o=function(){var e=this,t=e.$createElement;e._self._c},a=[];n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return r}))},"4ee6":function(e,t,n){"use strict";var r=n("a115"),o=n.n(r);o.a},"57b5":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;n("4a45");var r=n("0bc1"),o=n("4be7"),a=n("116b");function i(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=s(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,a=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(i)throw o}}}}function s(e,t){if(e){if("string"===typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c=function(){n.e("components/uni-collapse/uni-collapse").then(function(){return resolve(n("8202"))}.bind(null,n)).catch(n.oe)},u=function(){n.e("components/uni-collapse-item/uni-collapse-item").then(function(){return resolve(n("cf28"))}.bind(null,n)).catch(n.oe)},l=function(){n.e("components/uni-steps/uni-steps").then(function(){return resolve(n("92e3"))}.bind(null,n)).catch(n.oe)},f={components:{uniCollapse:c,uniCollapseItem:u,uniSteps:l},data:function(){return{provider:"weixin",page:{total:0,current:1,size:100,pages:1,descs:"create_time",orders:[]},code:null,userId:"",headerPosition:"fixed",headerTop:"0px",typeText:{UNPAID:"等待付款",BACK:"等待商家发货",UNRECEIVED:"商家已发货",RECEIVED:"等待用户评价",COMPLETED:"交易已完成",REFUNDS:"商品退货处理中",CANCELLED:"订单已取消"},orderType:["全部","待付款","待发货","待收货","待评价","已完成","退款","已取消"],typeList:["","UNPAID","BACK","UNRECEIVED","RECEIVED","COMPLETED","REFUNDS","CANCELLED"],orderList:[],list:[],tabbarIndex:null,tabIndex:0,scrollInto:"",showTips:!1,navigateFlag:!1,pulling:!1,tabBars:[{name:"全部",id:null},{name:"待付款",id:"UNPAID"},{name:"待发货",id:"BACK"},{name:"待收货",id:"UNRECEIVED"},{name:"待评价",id:"RECEIVED"},{name:"已完成",id:"COMPLETED"},{name:"退货",id:"REFUNDS"},{name:"已取消",id:"CANCELLED"}],active:0,orderSteps:[{title:"已下单",desc:"2018-11-11"},{title:"已完成",desc:"2018-11-14"}],likeList:[],likeMarginTop:"1px"}},onLoad:function(t){var n=this,r=this.provider;null!=r&&""!=r||e.getProvider({service:"oauth",success:function(e){r=e.provider[0],n.provider=e.provider[0]}}),e.login({provider:r,success:function(e){n.code=e.code}}),this.userId=e.getStorageSync("userId");var o=t.tbIndex;this.tabbarIndex=null==o?null:o,this.list.length<3&&this.loadGoodsList()},onShow:function(){this.loadOrderList(this.tabbarIndex);for(var e=0;e<this.tabBars.length;e++)if(this.tabBars[e].id==this.tabbarIndex)return this.switchTab(e),!1},onPageScroll:function(e){},methods:{loadGoodsList:function(){var e=this,t={current:1,size:6,type:"2"};(0,a.getGoodsList)(t).then((function(t){if(0==t.data.code&&null!=t.data.data&&(e.page.currentPage=t.data.data.current,e.page.pages=t.data.data.pages,(e.page.current=1)&&(e.likeList=[]),t.data.data.records.length>0)){var n=t.data.data.records;n.length%2!=0&&n.pop();var r,o=i(n);try{for(o.s();!(r=o.n()).done;){var a=r.value;e.likeList.push(a)}}catch(s){o.e(s)}finally{o.f()}}e.loadingText=""}))},loadOrderList:function(t){var n=this,o={userId:this.userId,status:""==t?null:t,delFlag:0};e.showLoading({title:"正在获取订单..."}),Object.assign(o,this.page),(0,r.getOrdersList)(o).then((function(t){if(0==t.data.code&&t.data.data.records.length>0){n.page.current<=1&&(n.list=[]);var r,o=i(t.data.data.records);try{for(o.s();!(r=o.n()).done;){var a=r.value,s={type:a.status,ordersn:a.orderSn,orderNo:a.orderNo,goods_id:a.goodsId,imgs:null!=a.coverImgs?a.coverImgs:"/static/img/noorder.png",name:a.goodsName,price:""+a.goodsPrice,payment:""+a.paymentPrice,freight:""+a.freight,spec:"规格:"+a.specsNames,numner:a.number,createTime:a.createTime,id:a.id,progressList:null==a.progressList?[]:a.progressList,active:0};s.active=s.progressList.length,n.list.push(s)}}catch(d){o.e(d)}finally{o.f()}}else 0==t.data.code&&0==t.data.data.records.length&&(n.list=[]);e.hideLoading()}))},showLogistics:function(e){},clickOrder:function(t){console.log("订单信息"),e.navigateTo({url:"./comments?goodsId="+t.goods_id+"&spec="+t.spec+"&orderId="+t.id})},gotoComments:function(e){console.log(e);var t={userId:this.userId,code:this.code,encryptedData:e.mp.detail.encryptedData,iv:e.mp.detail.iv,state:getApp().globalData.PROVIDER[this.provider]};(0,o.updateUserInfo)(t).then((function(e){console.log(e)}))},togoOrderSteps:function(e){console.log(e)},remindDeliver:function(t,n){var o=this,a={payOrderId:n.ordersn,type:t,userId:this.userId};(0,r.dealOrder)(a,n.id).then((function(t){if(0==t.data.code)return setTimeout((function(){e.showToast({title:null!=t.data.msg?t.data.msg:"操作成功",icon:0==t.data.code?"success":"none"})}),300),o.loadOrderList(o.tabbarIndex),!1;e.showToast({title:null!=t.data.msg?t.data.msg:"操作失败",icon:0==t.data.code?"success":"none"})}))},cancelOrder:function(t){var n=this;e.showModal({title:"取消订单",content:"确定取消此订单？",success:function(e){e.confirm?n.doCancelOrder(t):e.cancel}})},doComments:function(e){},doCancelOrder:function(t){for(var n=this.orderList.length,o=0;o<n;o++){var a=this.orderList[o],i=a.length;if(i>0&&"unpaid"==a[0].type)for(var s=0;s<i;s++)if(this.orderList[o][s].ordersn==t.ordersn){this.orderList[o][s].type="cancelled";break}}var d={id:t.id,delFlag:"1"};(0,r.updateOrder)(d).then((function(n){0==n.data.code&&null!=n.data.data&&(setTimeout((function(){e.showToast({title:"取消成功",icon:"none"})}),300),e.hideLoading()),document.getElementById(t.id).remove()}))},toPayment:function(t){e.showLoading({title:"正在获取订单..."});var n=[];n.push(t),setTimeout((function(){e.setStorage({key:"paymentOrder",data:n,success:function(){e.hideLoading(),e.navigateTo({url:"../../pay/payment/payment?amount="+t.payment+"&goodsId="+t.goods_id+"&orderName="+t.name+"&orderId="+t.id})}})}),500)},ontabtap:function(e){var t=e.target.dataset.current||e.currentTarget.dataset.current;this.switchTab(t),this.tabbarIndex=e.currentTarget.id,this.loadOrderList(this.tabbarIndex)},switchTab:function(e){this.tabIndex!==e&&(this.tabIndex=e,this.scrollInto=this.tabBars[e].id)},toGoodsPage:function(t){e.navigateTo({url:"../../goods/goods?gid="+t})},toOrderPage:function(t){e.navigateTo({url:"../../user/order_list/order_detail?u=0&oid="+t})}}};t.default=f}).call(this,n("543d")["default"])},"80c9":function(e,t,n){"use strict";n.r(t);var r=n("57b5"),o=n.n(r);for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);t["default"]=o.a},a115:function(e,t,n){},c2a2:function(e,t,n){"use strict";n.r(t);var r=n("3deb"),o=n("80c9");for(var a in o)"default"!==a&&function(e){n.d(t,e,(function(){return o[e]}))}(a);n("4ee6");var i,s=n("f0c5"),d=Object(s["a"])(o["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],i);t["default"]=d.exports}},[["2f75","common/runtime","common/vendor"]]]);