(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/order_list/order_detail"],{"1a03":function(t,e,o){"use strict";var n,a=function(){var t=this,e=t.$createElement,o=(t._self._c,t._f("toFixed")(t.orderInfo.goodsPrice)),n=t._f("toFixed")(t.orderInfo.freight),a=t._f("toFixed")(t.orderInfo.deduction),r=t._f("toFixed")(t.orderInfo.paymentPrice),s=t._f("toFixed")(t.deduction),i=t.adapterPostType(t.orderInfo.postType);t.$mp.data=Object.assign({},{$root:{f0:o,f1:n,f2:a,f3:r,f4:s,m0:i}})},r=[];o.d(e,"b",(function(){return a})),o.d(e,"c",(function(){return r})),o.d(e,"a",(function(){return n}))},4359:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=o("4a45"),a=o("4be7"),r=o("f169"),s=o("0bc1");function i(t){if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=d(t))){var e=0,o=function(){};return{s:o,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a,r=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return r=t.done,t},e:function(t){s=!0,a=t},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw a}}}}function d(t,e){if(t){if("string"===typeof t)return c(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(o):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var u={data:function(){return{baseUrl:n.requestURL,userId:null,orderList:[],goodsPrice:0,sumPrice:0,freight:0,note:"",int:0,deduction:0,provider:"",openId:"",authorization:null,code:"",orderId:"",amount:0,orderName:"",goodsId:"",channel:"wxpay",skuId:0,orderInfo:{},userType:0,dialogShow:!1,posterData:{postType:null,postNo:null},postDicData:[{label:"顺丰速递",value:"SF"}],postIndex:0}},computed:{dialogSize:function(){}},onShow:function(){},onHide:function(){},onLoad:function(e){var o=this.provider;null!=o&&""!=o||(t.getProvider({service:"oauth",success:function(t){o=t.provider[0]}}),this.provider=o),this.channel="toutiao"==this.provider?"ALIPAY":"WXPAY",this.openId=t.getStorageSync("miniOpenId"),this.userId=t.getStorageSync("userId"),this.authorization=t.getStorageSync("Authorization"),this.orderId=e.oid,this.loadOrderInfo(),this.loadSysDicList(),this.userType=e.u},onBackPress:function(){this.clearOrder()},filters:{toFixed:function(t){return parseFloat(t).toFixed(2)}},methods:{updateOrderStatus:function(){var e=this,o={orderId:this.orderId,type:4,status:"UNRECEIVED",postType:this.posterData.postType,postNo:this.posterData.postNo};null!=o.postType&&null!=o.postNo?(0,s.dealOrder)(o).then((function(n){0==n.data.code&&null!=n.data.data&&(setTimeout((function(){t.showToast({title:"提交成功",icon:"success",duration:1e3})}),300),e.orderInfo.status="UNRECEIVED",e.orderInfo.postNo=o.postNo,e.orderInfo.statusStr="商家已经发货",e.closeDialog(),t.hideLoading())})):t.showToast({title:"请填写快递信息",icon:"none"})},loadSysDicList:function(){var e=this,o=t.getStorageSync("postList");null!=o&&o.length>0?this.postDicData=o:(0,r.getSysDictItem)("post_type",{}).then((function(o){e.postDicData=o.data.data,t.setStorageSync("postList",o.data.data)})),e.posterData.postType=this.postDicData[0].value},adapterPostType:function(t){var e,o=i(this.postDicData);try{for(o.s();!(e=o.n()).done;){var n=e.value;if(n.value==t)return n.label}}catch(a){o.e(a)}finally{o.f()}return"未知"},loadOrderInfo:function(){var t=this,e=this.orderId;(0,s.getOrderInfo)(e).then((function(e){if(0==e.data.code&&null!=e.data.data){var o=e.data.data;null==o.goodsList&&(o.goodsList=[{goodsId:o.goodsId,goodsName:o.goodsName,skuId:o.skuId,skuName:o.skuName,number:o.number,img:o.coverImgs}]),t.orderInfo=o,t.orderList.push(o)}}))},oauthLogin:function(e){var o=this,a=this.provider;t.login({provider:a,success:function(r){var s=getApp().globalData.PROVIDER[a];t.request({url:n.requestURL+"/auth/mobile/token/social?grant_type=mobile&mobile="+s+"@"+r.code,method:"post",header:{Authorization:getApp().globalData.CLIENT},success:function(n){200==n.statusCode&&(t.setStorageSync("Authorization","Bearer "+n.data.access_token),o.authorization="Bearer "+n.data.access_token,t.setStorageSync("TENANT-ID",n.data.tenant_id),t.setStorageSync("refreshToken",n.data.refresh_token),t.setStorageSync("refreshTokenTime",parseInt((new Date).getTime()/1e3)),t.setStorageSync("userId",n.data.user_id),t.setStorageSync("userName",n.data.username),e&&o.toPay())}})},fail:function(e){t.hideLoading()}})},clearOrder:function(){var e=this;t.removeStorage({key:"buylist",success:function(t){e.buylist=[]}})},toPay:function(){t.showLoading({title:"开始支付..."});var e=t.getStorageSync("shareUserId"),o={appId:getApp().globalData.wxAppId,appCode:getApp().globalData.APPNAME,paymentPrice:this.orderInfo.paymentPrice,note:this.orderInfo.note,goodsPrice:this.orderInfo.goodsPrice,integral:this.orderInfo.integral,deduction:this.orderInfo.deduction,receiveAddId:this.orderInfo.receiveAddId,receiveInf:this.orderInfo.receiveInf,specsNames:this.orderInfo.specsNames,goodsId:this.orderInfo.goodsId,skuId:this.orderInfo.skuId,shareUserId:e};this.deleteProperties(o),this.doDeposit()},doDeposit:function(){var e=this,o=this.provider;if("toutiao"==o)return this.payment(null),!1;""==this.openId?t.login({provider:o,success:function(n){var r={code:n.code,state:getApp().globalData.PROVIDER[o]};(0,a.getOpenId)(r).then((function(o){0==o.data.code?(e.openId=o.data.data,t.setStorageSync("miniOpenId",o.data.data),e.payment(o.data.data)):console.log(o)}))},fail:function(t){console.log(t)}}):this.payment(this.openId)},payment:function(e){var o=this,n=this.channel,a=a=parseFloat(this.amount).toFixed(2),r={appId:getApp().globalData.wxAppId,appCode:getApp().globalData.APPNAME,amount:100*a,goodsName:this.orderInfo.goodsName,openId:e,goodsId:this.orderInfo.goodsId,userId:this.userId,orderId:this.orderId,skuId:this.skuId,channel:this.channel,payType:"WXPAY"==this.channel?"JSAPI":"APP"};(0,s.addPaymentOrder)(r).then((function(e){401==e.statusCode&&o.oauthLogin(!0),0==e.data.code?"WXPAY"==n?o.wxPay(e.data.data.params,a):o.ttPay(e.data.data.params,a):t.showToast({title:e.data.msg?e.data.msg:"下单失败",icon:"none"})})).catch((function(e){t.showToast({title:"下单失败",icon:"none"})}))},wxPay:function(e,o){t.showLoading({title:"正在支付..."}),wx.requestPayment({timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:"MD5",paySign:e.paySign,success:function(e){t.showToast({title:"支付成功",icon:"success"}),t.redirectTo({url:"/pages/pay/success/success?amount="+o})},fail:function(e){console.log("支付失败"),t.showToast({title:"支付失败",icon:"none"}),t.redirectTo({url:"/pages/user/order_list/order_detail?oid="+this.orderId}),t.hideLoading()},complete:function(e){console.log("支付完成"),t.hideLoading()}})},ttPay:function(t,e){tt.pay({orderInfo:t,service:1,getOrderStatus:function(t){t.out_order_no;return new Promise((function(t,e){tt.request({url:"<your-backend-url>",success:function(e){t({code:11})},fail:function(t){e(t)}})}))},success:function(t){0==t.code&&console.log("支付成功")},fail:function(t){console.log("支付fail"),console.log(t)}})},selectAddress:function(){t.chooseAddress({success:function(e){var o={cityName:e.cityName,countyName:e.countyName,detailInfo:e.detailInfo,provinceName:e.provinceName,contactPhone:e.telNumber,contactUserName:e.userName,nationalCode:e.nationalCode,receiveInf:e.provinceName+" "+e.cityName+" "+e.countyName},n=[];t.getStorage({key:"addressList",success:function(t){n=t.data,n.push(o)}}),t.setStorageSync("addressList",n),t.setStorageSync("address",o),t.setStorageSync("selectAddress",o)},fail:function(t){console.log("获取地址失败了")}})},deleteProperties:function(t){delete t.releaseTime,delete t.updateTime,delete t.status,delete t.slogan,delete t.img,delete t.salesNum,delete t.inventory,delete t.id},checkUserSession:function(){console.log("获取到的UserId:"+this.userId)},toPoster:function(){this.openDialog()},scanBarQr:function(){var e=this;t.scanCode({scanType:["barCode"],success:function(t){e.posterData.postNo=t.result}})},bindPickerChange:function(t){this.postIndex=t.target.value,this.posterData.postType=this.postDicData[t.target.value].value,this.orderInfo.postTypeStr=this.postDicData[this.postIndex].label},openDialog:function(t,e){this.dialogShow=!0},closeDialog:function(){this.dialogShow=!1},toGoodsPage:function(e){t.navigateTo({url:"../../goods/goods?gid="+e})},copyOrderNo:function(e,o){t.setClipboardData({data:e,success:function(){t.showToast({icon:"none",title:o+"已经复制"})}})}}};e.default=u}).call(this,o("543d")["default"])},"4ac3":function(t,e,o){"use strict";o.r(e);var n=o("4359"),a=o.n(n);for(var r in n)"default"!==r&&function(t){o.d(e,t,(function(){return n[t]}))}(r);e["default"]=a.a},"58c5":function(t,e,o){"use strict";o.r(e);var n=o("1a03"),a=o("4ac3");for(var r in a)"default"!==r&&function(t){o.d(e,t,(function(){return a[t]}))}(r);o("7193");var s,i=o("f0c5"),d=Object(i["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);e["default"]=d.exports},7193:function(t,e,o){"use strict";var n=o("8fa2"),a=o.n(n);a.a},"8fa2":function(t,e,o){},f646:function(t,e,o){"use strict";(function(t){o("1822");n(o("66fd"));var e=n(o("58c5"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("543d")["createPage"])}},[["f646","common/runtime","common/vendor"]]]);