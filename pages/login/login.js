(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{"1bd7":function(e,t,o){"use strict";o.r(t);var a=o("33be"),n=o.n(a);for(var r in a)"default"!==r&&function(e){o.d(t,e,(function(){return a[e]}))}(r);t["default"]=n.a},"33be":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o("4a45"),n=o("1fb1");o("f169"),r(o("394c"));function r(e){return e&&e.__esModule?e:{default:e}}var s={data:function(){return{appName:getApp().globalData.APPNAME,phoneNumber:"",passwd:"",isShowOauth:!0,showProvider:{weixin:!1,qq:!1,toutiao:!1,sinaweibo:!1,xiaomi:!1},face:"",provider:"",route:"/pages/user/user",pageHeight:0}},onShow:function(){},onLoad:function(e){this.getProvider(),this.getLogo(),console.log(e),null!=e.route&&(this.route="/"+e.route),console.log(this.route)},methods:{getphonenumber:function(e){console.log(e)},oauthLogin:function(t){var o=this;e.showLoading({title:"正在登录..."}),e.login({provider:t,success:function(e){console.log(e),o.loginByCode(e.code)},fail:function(t){console.log("fail: "+JSON.stringify(t)),e.hideLoading()}})},loginByCode:function(t){var o=getApp().globalData.APPTYPE;e.request({url:a.requestURL+"/auth/mobile/token/social?grant_type=mobile&mobile="+o+"@"+t,method:"post",header:{Authorization:getApp().globalData.CLIENT,"TENANT-ID":getApp().globalData.TENANTID,client:getApp().globalData.APPNAME.toLowerCase()},success:function(t){if(e.hideLoading(),console.log(t),401===t.statusCode)return e.showToast({title:"该账号还未绑定",icon:"none"}),setTimeout((function(){e.hideKeyboard(),e.navigateTo({url:"bind?state="+o+"&code=auu"})}),500),!1;200==t.statusCode?(e.setStorageSync("Authorization","Bearer "+t.data.access_token),e.setStorageSync("refreshToken",t.data.refresh_token),e.setStorageSync("refreshTokenTime",parseInt((new Date).getTime()/1e3)),e.setStorageSync("userId",t.data.user_id),e.setStorageSync("userName",t.data.username),e.showToast({title:"登录成功",icon:"success"}),setTimeout((function(){e.navigateBack()}),200)):426==t.statusCode&&e.showToast({title:"账号或者密码错误",icon:"none"})}})},getProvider:function(){var t=this;e.getProvider({service:"oauth",success:function(e){console.log(e);for(var o=e.provider.length,a=0;a<o;a++)t.showProvider[e.provider[a]]=!0;0==e.provider.length&&(t.isShowOauth=!1),t.provider=e.provider[0],getApp().globalData.APPTYPE=getApp().globalData.PROVIDER[e.provider[0]]}})},toPage:function(t){e.hideKeyboard(),e.navigateTo({url:t})},getLogo:function(){},doLogin:function(){e.hideKeyboard(),e.showLoading({title:"登录中..."});var t={password:this.passwd},o=(0,n.encryption)({data:t,key:"pigxpigxpigxpigx",param:["password"]});o=(0,n.URLencode)(o.password);var r="/auth/oauth/token?password="+o+"&username="+this.phoneNumber+"&randomStr=1&code=1&grant_type=password&scope=server";e.request({url:a.requestURL+r,data:{},header:{Authorization:getApp().globalData.CLIENT,"TENANT-ID":getApp().globalData.TENANTID,client:"auu"},method:"POST",success:function(t){return 200==t.statusCode?(console.log(t.data),e.setStorageSync("Authorization","Bearer "+t.data.access_token),e.setStorageSync("refreshToken",t.data.refresh_token),e.setStorageSync("refreshTokenTime",parseInt((new Date).getTime()/1e3)),e.setStorageSync("userId",t.data.user_id),e.setStorageSync("userName",t.data.username),setTimeout((function(){e.showToast({title:"登录成功",icon:"success"}),e.navigateBack()}),200),!1):426==t.statusCode?(e.showToast({title:"账号或者密码错误",icon:"none"}),!1):void e.showToast({title:t.data.msg?t.data.msg:"账号或密码不正确",icon:"none"})},fail:function(t){console.log("登录错误了"),console.log(t),e.showToast({title:t.data.msg?t.data.msg:"账号或密码不正确",icon:"none"})}})}}};t.default=s}).call(this,o("543d")["default"])},"3c0a":function(e,t,o){"use strict";var a,n=function(){var e=this,t=e.$createElement;e._self._c},r=[];o.d(t,"b",(function(){return n})),o.d(t,"c",(function(){return r})),o.d(t,"a",(function(){return a}))},"3d70":function(e,t,o){"use strict";o.r(t);var a=o("3c0a"),n=o("1bd7");for(var r in n)"default"!==r&&function(e){o.d(t,e,(function(){return n[e]}))}(r);o("9320");var s,i=o("f0c5"),u=Object(i["a"])(n["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],s);t["default"]=u.exports},9320:function(e,t,o){"use strict";var a=o("ac62"),n=o.n(a);n.a},a16b:function(e,t,o){"use strict";(function(e){o("1822");a(o("66fd"));var t=a(o("3d70"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},ac62:function(e,t,o){}},[["a16b","common/runtime","common/vendor"]]]);