(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/bind"],{"29b9":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o("4a45"),a=o("4be7");s(o("394c"));function s(e){return e&&e.__esModule?e:{default:e}}var i={data:function(){return{userId:0,phoneNumber:"",code:"",passwd:"",getCodeText:"获取验证码",getCodeBtnColor:"#ffffff",getCodeisWaiting:!1,state:"",auth_code:"",face:"/static/img/logo.png",nickName:"",provider:""}},onLoad:function(t){this.auth_code=t.code,this.state=t.state;var o=e.getStorageSync("UserInfo").avatar;this.face=""==o?this.face:o},methods:{Timer:function(){},getCode:function(){var t=this;if(e.hideKeyboard(),!this.getCodeisWaiting){if(!/^1(3|4|5|6|7|8|9)\d{9}$/.test(this.phoneNumber))return e.showToast({title:"请填写正确手机号码",icon:"none"}),!1;this.getCodeText="发送中...",e.request({url:n.requestURL+"/admin/mobile/"+this.phoneNumber,header:{Authorization:getApp().globalData.CLIENT},method:"GET",success:function(o){if(0!=o.data.code||!o.data.data)return t.getCodeText="获取验证码",e.showToast({title:o.data.msg,icon:"none"}),!1;t.getCodeisWaiting=!0,t.getCodeBtnColor="rgba(255,255,255,0.5)",e.showToast({title:"验证码已发送",icon:"none"}),console.log("验证码："+o.data.data),setTimeout((function(){t.setTimer()}),100)},error:function(o){console.log("短信发送失败"),t.getCodeText="获取验证码",e.showToast({title:"验证码发送失败，请稍后再试",icon:"none"})}})}},setTimer:function(){var e=this,t=60;this.getCodeText="重新获取(60)",this.Timer=setInterval((function(){if(t<=0)return e.getCodeisWaiting=!1,e.getCodeBtnColor="#ffffff",e.getCodeText="获取验证码",void clearInterval(e.Timer);e.getCodeText="重新获取("+t+")",t--}),1e3)},smsLogin:function(){var t=this;return e.hideKeyboard(),/^1(3|4|5|6|7|8|9)\d{9}$/.test(this.phoneNumber)?(e.showLoading({title:"提交中..."}),e.request({url:n.requestURL+"/auth/mobile/token/sms?mobile=SMS@"+this.phoneNumber+"&code="+this.code+"&grant_type=mobile",data:{phone:this.phoneNumber,source:"wechat_mini",smsCode:this.code,tenantId:1,code:this.code,state:this.state},header:{"TENANT-ID":getApp().globalData.TENANTID,Authorization:getApp().globalData.CLIENT},method:"POST",success:function(o){if(null!==o.code&&1==o.code)return e.showToast({title:o.data.msg,icon:"none"}),!1;200==o.statusCode?(e.setStorageSync("Authorization","Bearer "+o.data.access_token),e.setStorageSync("TENANT-ID",o.data.tenant_id),e.setStorageSync("refreshToken",o.data.refresh_token),e.setStorageSync("refreshTokenTime",parseInt((new Date).getTime()/1e3)),e.setStorageSync("userId",o.data.user_id),e.setStorageSync("userName",o.data.username),t.userId=o.data.user_id,t.bindMiniWechat(),e.setStorage({key:"UserList",data:o.data,success:function(){e.hideLoading()}})):e.showToast({title:o.data.msg,icon:"none"})},fail:function(t){console.log(t),e.showToast({title:t.data.msg,icon:"none"})}}),e.hideLoading(),!1):(e.showToast({title:"请填写正确手机号码",icon:"none"}),!1)},getSocisallUserInfo:function(){var t=this;e.getUserInfo({provider:this.provider,success:function(o){console.log("获取用户信息"),console.log(o),t.face=o.userInfo.avatarUrl,e.setStorageSync("avatar",o.userInfo.avatarUrl),e.setStorageSync("wxUserInfo",o.userInfo),e.setStorage({key:"UserInfo",data:{username:o.userInfo.nickName,face:o.userInfo.avatarUrl,signature:"拒绝随波逐流，各凭态度乘风浪",integral:0,balance:0,envelope:0},success:function(){console.log("保存完成")}})}})},bindMiniWechat:function(){e.login({provider:"weixin",success:function(t){var o=getApp().globalData.APPTYPE;wx.request({url:n.requestURL+"/admin/social/bind?state="+o+"&code="+t.code,method:"post",header:{Authorization:"Bearer "+res.data.access_token},success:function(t){e.hideLoading(),e.showToast({title:"绑定成功",icon:"success"});var o=e.getStorageSync("wxUserInfo"),n={userId:this.userId,nickName:o.nickName,avatar:o.avatarUrl,gender:o.gender,source:getApp().globalData.APPNAME};(0,a.updateUserInfo)(n).then((function(e){console.log(e)})),setTimeout((function(){e.switchTab({url:"/pages/tabBar/home/home"})}),200)}})}})},toLogin:function(){e.hideKeyboard(),e.redirectTo({url:"register"}),e.navigateBack()}}};t.default=i}).call(this,o("543d")["default"])},3412:function(e,t,o){"use strict";var n=o("a0e9"),a=o.n(n);a.a},5890:function(e,t,o){"use strict";o.r(t);var n=o("29b9"),a=o.n(n);for(var s in n)"default"!==s&&function(e){o.d(t,e,(function(){return n[e]}))}(s);t["default"]=a.a},"75f0":function(e,t,o){"use strict";(function(e){o("1822");n(o("66fd"));var t=n(o("8f27"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},"8f27":function(e,t,o){"use strict";o.r(t);var n=o("eecd"),a=o("5890");for(var s in a)"default"!==s&&function(e){o.d(t,e,(function(){return a[e]}))}(s);o("3412");var i,r=o("f0c5"),c=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],i);t["default"]=c.exports},a0e9:function(e,t,o){},eecd:function(e,t,o){"use strict";var n,a=function(){var e=this,t=e.$createElement;e._self._c},s=[];o.d(t,"b",(function(){return a})),o.d(t,"c",(function(){return s})),o.d(t,"a",(function(){return n}))}},[["75f0","common/runtime","common/vendor"]]]);