(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/tabBar/user/user"],{"04ff":function(e,t,n){"use strict";var o=n("0d5c"),a=n.n(o);a.a},"0d5c":function(e,t,n){},1664:function(e,t,n){"use strict";n.r(t);var o=n("620b"),a=n.n(o);for(var s in o)"default"!==s&&function(e){n.d(t,e,(function(){return o[e]}))}(s);t["default"]=a.a},"553a":function(e,t,n){"use strict";(function(e){n("1822");o(n("66fd"));var t=o(n("ccf1"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},"620b":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n("4a45"),a=n("4be7"),s=n("116b");function r(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=i(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a,s=!0,r=!1;return{s:function(){o=e[Symbol.iterator]()},n:function(){var e=o.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==o.return||o.return()}finally{if(r)throw a}}}}function i(e,t){if(e){if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var c=function(){n.e("components/uni-nav-bar/uni-nav-bar").then(function(){return resolve(n("15b9"))}.bind(null,n)).catch(n.oe)},l={components:{uniNavBar:c},data:function(){return{userId:2,baseUrl:o.requestURL,isfirst:!0,headerPosition:"fixed",headerTop:null,statusTop:null,showHeader:!0,vipName:getApp().globalData.APPNAME,user:{name:getApp().globalData.APPNAME+"用户",face:"/static/img/face.png",signature:"点击昵称跳转登录/注册页",integral:0,balance:0,envelope:0},orderList:[{text:"待付款",icon:"fukuan",id:"UNPAID"},{text:"待发货",icon:"fahuo",id:"BACK"},{text:"待收货",icon:"shouhuo",id:"UNRECEIVED"},{text:"待评价",icon:"pingjia",id:"RECEIVED"},{text:"退换货",icon:"tuihuo",id:"REFUNDS"}],mytoolbarList:[{url:"/pages/user/live/live_home",text:"直播间",img:"/static/img/user/liveplayer.png",permission:""},{id:"coupon",url:"../../user/coupon/coupon",text:"优惠券",img:"/static/img/user/quan.png"},{url:"../../user/address/address",text:"收货地址",img:"/static/img/user/addr.png",id:"address",permission:""},{url:"/pages/login/login",text:"账户安全",img:"/static/img/user/security.png",id:"login"},{url:"/pages/user/manager/product/product",text:"发布商品",img:"/static/img/user/renw.png",permission:"goods_goods_add"},{url:"/pages/user/manager/orders/orders",text:"订单管理",img:"/static/img/user/orderM.png",permission:"order_order_edit"}],page:{total:0,current:1,size:10,pages:10,orders:[]},loadingText:"正在加载...",likeList:[],likeMarginTop:"1px",provider:null,permissions:[],code:null}},onPullDownRefresh:function(){var t=this;t.loadUserMallInfo(),t.getUserSysInfo(),setTimeout((function(){e.stopPullDownRefresh()}),1e3)},onPageScroll:function(e){this.headerPosition=e.scrollTop>=0?"fixed":"absolute",this.headerTop=e.scrollTop>=0?null:0,this.statusTop=e.scrollTop>=0?null:-this.statusHeight+"px"},onShow:function(){this.checkLoginSession(),this.userId=e.getStorageSync("userId")},onLoad:function(){var t=this;this.userId=e.getStorageSync("userId"),this.statusHeight=0;var n=this.provider;null!=n&&""!=n||e.getProvider({service:"oauth",success:function(e){n=e.provider[0],t.provider=e.provider[0]}}),"toutiao"==n&&e.authorize({scope:"scope.userInfo",success:function(){t.getSocisallUserInfo()},fail:function(e){console.log(e)}}),this.loadGoodsList(),this.getUserSysInfo()},onReady:function(){},methods:{updateUserInfo:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){var t={userId:this.userId,avatar:avatarUrl,nickname:nickName};e.setStorageSync("avatar",avatarUrl),e.setStorageSync("nickname",nickname),updateUserInfo(t).then((function(e){console.log(e)}))})),validataPerssion:function(e){return null==e||""==e||null!=this.permissions&&0!=this.permissions.length&&this.permissions.indexOf(e)>-1},getUserSysInfo:function(){var t=this;(0,a.getUserBaseInfo)().then((function(n){null!=n.data.data&&(e.setStorageSync("permission",n.data.data.permissions),t.permissions=n.data.data.permissions)}))},checkLoginSession:function(){if(null!=this.userId&&""!=this.userId)return this.loadUserMallInfo(),!1;"weixin"!=this.provider&&"toutiao"!=this.provider||this.oauthLogin()},oauthLogin:function(){var t=this,n=this.provider;e.login({provider:n,success:function(a){var s=getApp().globalData.PROVIDER[n];getApp().globalData.APPTYPE=s,e.request({url:o.requestURL+"/auth/mobile/token/social?grant_type=mobile&mobile="+s+"@"+a.code,method:"post",header:{Authorization:getApp().globalData.CLIENT,"TENANT-ID":getApp().globalData.TENANTID},success:function(n){e.setStorageSync("Authorization","Bearer "+n.data.access_token),e.setStorageSync("TENANT-ID",n.data.tenant_id),e.setStorageSync("refreshToken",n.data.refresh_token),e.setStorageSync("refreshTokenTime",parseInt((new Date).getTime()/1e3)),e.setStorageSync("userId",n.data.user_id),e.setStorageSync("userName",n.data.username),t.userId=n.data.user_id,t.loadUserMallInfo(),t.getUserSysInfo()}})},fail:function(t){console.log("用户拒绝了授权: "+JSON.stringify(t)),e.hideLoading()}}),console.log("登录成功：userid:"+this.userId)},getSocisallUserInfo:function(){var t=this;this.user;e.getUserInfo({provider:this.provider,success:function(n){t.user.face=n.userInfo.avatarUrl,t.user.name=n.userInfo.nickName,e.setStorageSync("avatar",n.userInfo.avatarUrl),e.setStorageSync("name",n.userInfo.nickName);var o={name:n.userInfo.nickName,face:n.userInfo.avatarUrl,signature:"拒绝随波逐流，各凭态度乘风浪",integral:0,balance:0,envelope:0};o,e.setStorageSync("SocUserInfo",o)},fail:function(e){console.log(e)}})},loadGoodsList:function(){var e=this,t={current:this.page.current,size:this.page.size,type:"2"};Object.assign(t,this.page),(0,s.getGoodsList)(t).then((function(t){if(0==t.data.code&&null!=t.data.data&&(e.page.currentPage=t.data.data.current,e.page.pages=t.data.data.pages,(e.page.current=1)&&(e.likeList=[]),t.data.data.records.length>0)){var n,o=t.data.data.records,a=r(o);try{for(a.s();!(n=a.n()).done;){var s=n.value;e.likeList.push(s)}}catch(i){a.e(i)}finally{a.f()}}e.loadingText=""}))},loadUserInfo:function(){(0,a.getUserInfo)(this.userId).then((function(e){if(0==e.data.code&&null!=e.data.data)e.data.data}))},loadUserMallInfo:function(){var e=this;if(null==this.userId)return!1;(0,a.getUserMallInfo)(this.userId).then((function(t){if(0==t.data.code&&null!=t.data.data){e.user.balance=0,e.user.envelope=0,e.user.integral=0;Object.assign(e.user,t.data.data);e.user=Object.assign(t.data.data,e.user)}}))},subscribeMsg:function(){e.requestSubscribeMessage({tmplIds:["18_6Z9H4Pw-zNjFhPjQJRbdb3MM8LObjvbNe34eEpA8"],success:function(e){console.log("订阅失成功："),console.log(e)},fail:function(e){console.log("订阅失败："),console.log(e)},complete:function(e){console.log("订阅结束："),console.log(e)}})},toSignin:function(){var t=this;if(null==this.userId||""==this.userId)return e.showToast({title:"您还未登录，请先登录",icon:"none"}),!1;var n={appCpde:getApp().globalData.appCode,fromId:0,userId:this.userId,type:"SIGN"};(0,a.increaseIntegral)(n).then((function(n){0==n.data.code&&e.showToast({title:n.data.msg?n.data.msg:"签到成功",icon:"success"}),null!=n.data.data&&n.data.data>0&&(t.user.integral+=n.data.data)}))},toMsg:function(){e.requestSubscribeMessage({tmplIds:["18_6Z9H4Pw-zNjFhPjQJRbdb3MM8LObjvbNe34eEpA8"],success:function(e){console.log("订阅失成功："),console.log(e)},fail:function(e){console.log("订阅失败："),console.log(e)},complete:function(e){console.log("订阅结束："),console.log(e)}}),e.showToast({title:"暂时没有消息",icon:"none"})},toOrderList:function(t){if(null==this.userId||""==this.userId)return e.showToast({title:"您还未登录，请先登录",icon:"none"}),!1;e.setStorageSync("tbIndex",t),e.navigateTo({url:"../../user/order_list/order_list?tbIndex="+t,success:function(){e.requestSubscribeMessage({tmplIds:["18_6Z9H4Pw-zNjFhPjQJRbdb3MM8LObjvbNe34eEpA8"],success:function(e){console.log("订阅失成功："),console.log(e)},fail:function(e){console.log("订阅失败："),console.log(e)},complete:function(e){console.log("订阅结束："),console.log(e)}})}})},toIntegralList:function(t,n){if(null==this.userId||""==this.userId)return e.showToast({title:"您还未登录，请先登录",icon:"none"}),!1;e.navigateTo({url:"../../user/integral/integral_list?categroy="+t+"&title="+n})},toSetting:function(){e.navigateTo({url:"../../user/setting/setting"})},toMyQR:function(){e.navigateTo({url:"../../user/myQR/myQR"})},toLogin:function(){e.navigateTo({url:"../../login/login"}),this.isfirst=!1},toGoods:function(t){e.navigateTo({url:"../../goods/goods?gid="+t.goodsId})},gotoHomePage:function(){e.switchTab({url:"/pages/tabBar/home/home"})},isLogin:function(){var t=e.getStorageSync("UserInfo");return!!t},toDeposit:function(){e.navigateTo({url:"../../user/deposit/deposit"})},toOriagnAddress:function(){e.chooseAddress({success:function(t){var n={cityName:t.cityName,countyName:t.countyName,detailInfo:t.detailInfo,provinceName:t.provinceName,contactPhone:t.telNumber,contactUserName:t.userName,nationalCode:t.nationalCode,receiveInf:t.provinceName+" "+t.cityName+" "+t.countyName},o=[];e.getStorage({key:"addressList",success:function(e){o=e.data,o.push(n)}})}})},toPage:function(t,n){if("address"==n)return this.toOriagnAddress(),!1;t?e.navigateTo({url:t}):e.showToast({title:"该项服务尚未开通",icon:"none"})},vipPower:function(){e.showToast({title:"您还不是会员",icon:"none"})},countMargin:function(){var e=2;e<1&&(e=0),this.likeMarginTop=e+"%"},onContact:function(){e.setClipboardData({data:"WHY1314WYC",success:function(){e.showToast({icon:"none",title:"已复制，请返回微信添加好友"})}})}}};t.default=l}).call(this,n("543d")["default"])},ccf1:function(e,t,n){"use strict";n.r(t);var o=n("e402"),a=n("1664");for(var s in a)"default"!==s&&function(e){n.d(t,e,(function(){return a[e]}))}(s);n("04ff");var r,i=n("f0c5"),u=Object(i["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],r);t["default"]=u.exports},e402:function(e,t,n){"use strict";var o={"uni-nav-bar":function(){return n.e("components/uni-nav-bar/uni-nav-bar").then(n.bind(null,"15b9"))},"uni-icons":function(){return Promise.all([n.e("common/vendor"),n.e("components/uni-icons/uni-icons")]).then(n.bind(null,"c930"))}},a=function(){var e=this,t=e.$createElement,n=(e._self._c,e.__map(e.mytoolbarList,(function(t,n){var o=e.validataPerssion(t.permission);return{$orig:e.__get_orig(t),m0:o}})));e.$mp.data=Object.assign({},{$root:{l0:n}})},s=[];n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return o}))}},[["553a","common/runtime","common/vendor"]]]);