(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/tabBar/home/home"],{"6bda":function(t,o,e){"use strict";(function(t){e("1822");n(e("66fd"));var o=n(e("9dbf"));function n(t){return t&&t.__esModule?t:{default:t}}t(o.default)}).call(this,e("543d")["createPage"])},"86ec":function(t,o,e){"use strict";(function(t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;r(e("d351"));var n=e("f169"),a=e("4be7"),i=e("4a45"),s=e("7435");function r(t){return t&&t.__esModule?t:{default:t}}var c=function(){e.e("components/uni-notice-bar/uni-notice-bar").then(function(){return resolve(e("a1be"))}.bind(null,e)).catch(e.oe)},l=function(){Promise.all([e.e("common/vendor"),e.e("components/uni-popup/uni-popup")]).then(function(){return resolve(e("38ef"))}.bind(null,e)).catch(e.oe)},d={components:{uniPopup:l,uniNoticeBar:c},data:function(){return{shopName:getApp().globalData.shopName,provider:null,baseUrl:i.requestURL,page:{total:0,currentPage:0,pageSize:20,pages:0},showHeader:!1,afterHeaderOpacity:1,headerPosition:"fixed",headerTop:null,statusTop:null,nVueTitle:null,city:"上海",currentSwiper:0,swiperList:[],adList:[],categoryList:[],Promotion:[],productList:[],loadingText:"正在加载...",noticeList:"",noticeShow:!1,swipperHight:"35px",dotStyle:!0,cardCur:0,userId:null,shareTitle:"我的态度就是AUU",shareUserId:null,windowHeight:"376px",couponTplList:[],swiperImgH:"130px",liveHome:null,liveStatus:{s101:"进行中",s102:"点击订阅",s103:"已结束",s104:"禁播",s105:"暂停中",s106:"异常",s107:"已过期"}}},onPageScroll:function(t){this.headerPosition=t.scrollTop>=0?"fixed":"absolute",this.headerTop=t.scrollTop>=0?null:0,this.statusTop=t.scrollTop>=0?null:-this.statusHeight+"px"},onPullDownRefresh:function(){this.atapter();var o=this;o.page.currentPage=0,o.loadGoodsList(!0),o.loadCategory(),o.loadAdList(),setTimeout((function(){t.stopPullDownRefresh(),o.couponTplList.length>0&&o.$refs["showimage"].open()}),1e3)},onReachBottom:function(){var o="加载新商品";if(this.page.currentPage<this.page.pages)return o="加载完成",void(this.loadingText="");this.page.currentPage+=1,t.showToast({title:o});var e=this.productList.length;if(e>=40)return this.loadingText="到底了",!1;this.loadGoodsList(!1)},onLoad:function(o){var e=this;this.loadAdList(),this.loadGoodsList(!0),this.loadCategory(),this.loadPromotion(),this.shareUserId=null,this.userId=t.getStorageSync("userId");var n=this.provider;null!=n&&""!=n||(t.getProvider({service:"oauth",success:function(t){n=t.provider[0]}}),this.provider=n);var a=o.u;if(null!=o.u)this.shareUserId=a;else if(null!=o.scene){var i=decodeURIComponent(o.scene);if(null!=i){var s=i.split("&");s.length>0&&(e.shareUserId=s[0].replace("u=",""))}}"weixin"!=n&&"toutiao"!=n||(t.showShareMenu({withShareTicket:!0,success:function(t){},fail:function(t){},complete:function(t){}}),setTimeout((function(){console.log("开始登录"),e.oauthLogin()}),1e3)),this.loadNotice(),this.Timer()},onShow:function(){this.close,this.userId=t.getStorageSync("userId"),this.checkLoginSession();t.getSystemInfoSync().windowHeight;var o=this;setTimeout((function(){o.atapter()}),1e3)},onShareAppMessage:function(t){return console.log("获取到的分享数据"),null!=t.u&&(this.shareUserId=u),"button"===t.from&&console.log(t),{title:this.shareTitle,path:"/pages/tabBar/home/home?u="+this.userId}},mounted:function(){},methods:{loadLivePlayerHomeList:function(){var t=this,o=getApp().globalData.wxAppId,e={};(0,a.getMpLiveHomeList)(e,o).then((function(o){if(console.log(o),0==o.data.code&&o.data.data){var e=JSON.parse(o.data.data),n=e.room_info;console.log(n),console.log(n);for(var a=0;a<n.length;a++){if(101==n[a].live_status){t.liveHome=n[a],console.log(t.liveHome);break}if(102==n[a].live_status){t.liveHome=n[a],console.log(t.liveHome);break}}}}))},toLiveHome:function(){var t=this.liveHome.roomid,o=encodeURIComponent(JSON.stringify({path:"pages/goods/goods",pid:1,gid:1})),e="plugin-private://wx2b03c6e691cd7370/pages/live-player-plugin?room_id="+t+"&custom_params="+o;wx.navigateTo({url:e})},toAddShareIntegral:function(){var o={appCpde:getApp().globalData.APPNAME,formId:null==this.userId?0:this.userId,goodsId:0,userId:this.shareUserId,type:"SHARE"};(0,a.increaseIntegral)(o).then((function(o){0==o.data.code&&o.data.msg&&t.showToast({title:"好友获得"+o.data.data+"积分",icon:"none"})})),this.shareUserId=null},loadCategory:function(){var t=this,o={current:1,size:10,level:1};(0,n.getCategoryList)(o).then((function(o){t.categoryList=o.data.data.records;for(var e=0;e<t.categoryList.length;e++)t.categoryList[e].img=t.categoryList[e].img;t.text="request success"}))},loadGoodsList:function(t){var o=this,e={current:this.page.currentPage,size:this.page.pageSize,type:"0"};(0,n.getCabinetList)(e).then((function(e){if(0==e.data.code&&null!=e.data.data){o.page.currentPage=e.data.data.current,o.page.total=e.data.data.total,o.page.pages=e.data.data.pages,t&&(o.productList=[]);for(var n=e.data.data.records,a=0;a<n.length;a++)n[a].img=n[a].imgs,o.productList.push(n[a])}})),this.loadingText=""},loadAdList:function(){var t=this,o={};(0,n.getAdlist)(o).then((function(o){0==o.data.code&&(t.swiperList=o.data.data.swipers,t.adList=o.data.data.adList,null!=o.data.data.promotion&&t.loadPromotion(o.data.data.promotion),null!=o.data.data.dialogs&&(t.couponTplList=o.data.data.dialogs),t.atapter())}))},loadNotice:function(){var t=this;(0,n.getNoticeMsg)({status:"1",delFlag:"0"}).then((function(o){if(0==o.data.code&&null!=o.data.data&&o.data.data.length>0){t.noticeList="",t.noticeShow=!0;for(var e=o.data.data,n=0;n<e.length;n++)1==e.length?t.noticeList=e[n].content:t.noticeList+=n+"，"+e[n].content+"         "}else t.closeNotice()}))},loadCouponTplList:function(){var t=this,o={scenes:"0",status:"0"};(0,s.getCouponTplList)(o).then((function(o){0==o.data.code&&null!=o.data.data&&(t.couponTplList=o.data.data,t.$refs["showimage"].open())}))},saveCoupon:function(o,e){var n={scenes:e,couponTplId:o};t.showLoading({title:"正在领取优惠券"}),(0,s.sendCoupon)(n).then((function(o){t.hideLoading(),t.showToast({title:0==o.data.code&&o.data.data?"领取成功":o.data.msg,icon:0==o.data.code&&o.data.data?"success":"none",duration:1500})})),this.$refs["showimage"].close()},checkLoginSession:function(){console.log("当前登录用户"+this.userId),null==this.userId?(t.removeStorageSync("Authorization"),t.removeStorageSync("userId"),this.oauthLogin()):(null!=this.shareUserId&&this.toAddShareIntegral(),null!=this.userId&&""!=this.userId&&this.loadLivePlayerHomeList())},oauthLogin:function(){var o=this.provider,e=this;t.login({provider:o,success:function(n){var a=getApp().globalData.PROVIDER[o];getApp().globalData.APPTYPE=a,console.log("开始登录"),t.request({url:i.requestURL+"/auth/mobile/token/social?grant_type=mobile&mobile="+a+"@"+n.code,method:"post",header:{Authorization:getApp().globalData.CLIENT,"TENANT-ID":getApp().globalData.TENANTID},success:function(o){200==o.statusCode&&(console.log(o),t.setStorageSync("Authorization","Bearer "+o.data.access_token),t.setStorageSync("refreshToken",o.data.refresh_token),t.setStorageSync("refreshTokenTime",parseInt((new Date).getTime()/1e3)),t.setStorageSync("userId",o.data.user_id),t.setStorageSync("userName",o.data.username),e.userId=o.data.user_id,null!=e.shareUserId&&e.toAddShareIntegral(),e.couponTplList.length>0&&e.$refs["showimage"].open(),e.loadLivePlayerHomeList())}})},fail:function(o){console.log("用户拒绝了授权: "+JSON.stringify(o)),t.hideLoading()}})},loadPromotion:function(t){if(null==t||0==t.length)return this.Promotion=[],!1;var o=new Date,e=o.getFullYear(),n=o.getMonth()+1,a=o.getDate(),i=e+"/"+n+"/"+a+" 23:59:59",s=[{title:"活动专区一",name:"活动专区",url:"/static/img/s1.jpg",countdown:!1},{title:"活动专区二",name:"活动专区",url:"/static/img/s2.jpg",countdown:i}];if(null!=t&&t.length>0){s=t;for(var r=0;r<s.length;r++)s[r].urls=s[r].urls}for(var u=0;u<s.length;u++){var c=s[u],l=s[u].countdown;if(c.countdown){var d="00",h="00",g="00",p=new Date,f=new Date(l);if(!(p>=f)){var m=parseInt((f.getTime()-p.getTime())/1e3);d=parseInt(m/3600),h=parseInt(m%3600/60),g=m%60,d=d<10?"0"+d:d,h=h<10?"0"+h:h,g=g<10?"0"+g:g}s[u].countdown={h:d,m:h,s:g}}}this.Promotion=s},Timer:function(){var t=this;setInterval((function(){if(t.Promotion.length>0)for(var o=0;o<t.Promotion.length;o++){var e=t.Promotion[o];e.countdown&&(0==e.countdown.h&&0==e.countdown.m&&0==e.countdown.s||(e.countdown.s>0?(e.countdown.s--,e.countdown.s=e.countdown.s<10?"0"+e.countdown.s:e.countdown.s):e.countdown.m>0?(e.countdown.m--,e.countdown.m=e.countdown.m<10?"0"+e.countdown.m:e.countdown.m,e.countdown.s=59):e.countdown.h>0&&(e.countdown.h--,e.countdown.h=e.countdown.h<10?"0"+e.countdown.h:e.countdown.h,e.countdown.m=59,e.countdown.s=59),t.Promotion[o].countdown=e.countdown))}}),1e3)},toMsg:function(){t.navigateTo({url:"../../msg/msg"})},toSearch:function(){t.showToast({title:"商品太少了，暂时不用搜索啦",icon:"none"})},toSwiper:function(t,o){if(null!=t.category&&1==t.category)return this.saveCoupon(t.couponTplId,o),!1;this.toGoods(t.goodsId)},toCategory:function(o){t.setStorageSync("catName",o.name),t.navigateTo({url:"../../goods/goods-list/goods-list?cid="+o.id+"&name="+o.name})},toPromotion:function(t){this.toGoods(t.goodsId)},toGoodsPage:function(t){this.toGoods(t.goodsId)},toGoods:function(o){t.navigateTo({url:"../../goods/goods?gid="+o})},gotoUserPage:function(){t.switchTab({url:"/pages/tabBar/user/user"})},swiperChange:function(t){this.currentSwiper=t.detail.current},closeNotice:function(){this.swipperHight="0px"},closeCoupon:function(){this.$refs["showimage"].close()},cardSwiper:function(t){this.cardCur=t.detail.current},atapter:function(){var o=this;t.createSelectorQuery().select(".swiper-image").boundingClientRect((function(t){if(null==t)return!1;var e=t.height+"px";o.swiperImgH=e})).exec()},onContact:function(){t.setClipboardData({data:"WHY1314WYC",success:function(){t.showToast({icon:"none",title:"已复制请返回微信添加好友"})}})}}};o.default=d}).call(this,e("543d")["default"])},"8f14":function(t,o,e){},"93e3":function(t,o,e){"use strict";e.r(o);var n=e("86ec"),a=e.n(n);for(var i in n)"default"!==i&&function(t){e.d(o,t,(function(){return n[t]}))}(i);o["default"]=a.a},"9dbf":function(t,o,e){"use strict";e.r(o);var n=e("e37b"),a=e("93e3");for(var i in a)"default"!==i&&function(t){e.d(o,t,(function(){return a[t]}))}(i);e("f37e");var s,r=e("f0c5"),u=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);o["default"]=u.exports},e37b:function(t,o,e){"use strict";var n={"uni-nav-bar":function(){return e.e("components/uni-nav-bar/uni-nav-bar").then(e.bind(null,"15b9"))},"uni-notice-bar":function(){return e.e("components/uni-notice-bar/uni-notice-bar").then(e.bind(null,"a1be"))},"uni-popup":function(){return Promise.all([e.e("common/vendor"),e.e("components/uni-popup/uni-popup")]).then(e.bind(null,"38ef"))},"uni-icons":function(){return Promise.all([e.e("common/vendor"),e.e("components/uni-icons/uni-icons")]).then(e.bind(null,"c930"))}},a=function(){var t=this,o=t.$createElement,e=(t._self._c,t._f("''")(t.liveHome.name));t.$mp.data=Object.assign({},{$root:{f0:e}})},i=[];e.d(o,"b",(function(){return a})),e.d(o,"c",(function(){return i})),e.d(o,"a",(function(){return n}))},f37e:function(t,o,e){"use strict";var n=e("8f14"),a=e.n(n);a.a}},[["6bda","common/runtime","common/vendor"]]]);